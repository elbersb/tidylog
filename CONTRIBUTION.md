# Contributing to tidylog

Thank you for your interest in contributing to `tidylog`! 

As of version 1.2.0, we use a code generation system for the wrappers to keep 
the package consistent and easy to maintain. This ensures that we always match 
the signatures, default arguments, and documentation of the underlying `dplyr` 
and `tidyr` functions without manual copy-pasting.

---

## The Wrapper Architecture

The package architecture is split into two parts: 
1. The **Loggers**, defined in `R/loggers` which contain the logic for what to report,
2. The **Wrappers** which provide the user-facing interface. 
  These are built dynamically into `R/generated_wrappers.R` (which should never be edited directly)
  based on 2 separated steps, the configuration and the engine:
    1.  **Configuration: `data-raw/wrapper_mapping.R`**. 
        This file defines the `wrapper_mapping` list, which maps specific loggers to vectors of function names.
    2.  **Engine: `data-raw/generate_wrappers.R`**: 
        This script sources the mapping and writes the standardized R code to `R/generated_wrappers.R`.


---

## How to Add a New Function

If you want to add support for a new function (e.g., a new verb from `dplyr` or `tidyr`), follow these steps:

### 1. Update the Mapping
Open `data-raw/wrapper_mapping.R` and add the full namespace-prefixed function name (as a string) to the appropriate logger category.

```r
wrapper_mapping <- list(
  log_mutate = c(
    "dplyr::mutate",
    "dplyr::mutate_all",
    "dplyr::new_function"  # Add your function here
  ),
  ...
)
```

### 2. Run the Generator

From the package root, run the generation script to update the source code:

```r
source("data-raw/generate_wrappers.R")
```

The engine will:
* **Validate**: Throw an error if the function name has a typo or the package isn't installed.
* **Inspect Formals**: Automatically extract the correct arguments and defaults using `formals()`.
* **Standardize**: Use `match.call()` to ensure that regardless of the argument order used by the user, 
    the primary data is correctly mapped to `.data` for the logger.
* **Update Documentation**: Calls `devtools::document()`.

### 3. Update and run test

Add tests for the new function and run all tests in the package.
```r
devtools::test()
```

---

## Important Guidelines

**[!WARNING] Do not edit `R/generated_wrappers.R` manually**. 
This file is automatically generated. Any manual changes will be overwritten 
the next time the generator script is run. Always make your changes in 
`data-raw/wrapper_mapping.R`.

### Logger Signatures
If you are creating a new logger function, ensure it follows these naming conventions for arguments:
* **Standard Loggers**: Should accept `.data`, `.fun`, and `.funname`.
* **Join Loggers**: Should accept `x`, `y`, `by`, `.fun`, `.funname`, `.name_x`, and `.name_y`.

### Documentation Inheritance
We use Roxygen2's `@inherit` and `@inheritParams` tags in the generator to automatically generate documentation. 
This ensures that when a user looks at `?tidylog::filter`, for example, 
they see the exact same parameter descriptions as `?dplyr::filter`, 
plus a note that the function is a `tidylog` wrapper.
